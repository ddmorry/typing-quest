# ロードマップ（スリム版）: Typing RPG（MVP → v1.0）

作成日: 2025-08-23（Asia/Phnom_Penh）
対象: **MVPリリース中心**（v1.0は最短差分）
責任者: オーナー（TBD）

---

## 0. 目的 / 成功指標

- **MVPの目的**: PRDのコアループ（攻撃/回復の二択 + ガード）を、最低限のA11yとデータ保存込みで**シンプルに提供**。
- **KPI（MVP期の仮）**
  - 初回セッション長 ≥ 6分（中央値）
  - 正答率（Accuracy）≥ 90%（中央値）
  - 7日継続率（D7） ≥ 20%（試験ユーザー）
  - ゲスト→登録転換 ≥ 10%

> KPIは計測が可能になったら見直し。

---

## 1. マイルストーン（MVP優先）

- **M0: Sprint 0（準備）** — 2025-08-25 〜 2025-08-26
- **M1: MVPコードフリーズ** — 2025-09-12
- **M2: MVPリリース** — 2025-09-16
- **M3: v1.0 コードフリーズ** — 2025-10-11（目安）
- **M4: v1.0 リリース** — 2025-10-15（目安）

---

## 2. 範囲（MVP / 最小）

- 1対1のバトル、**左=回復 / 右=攻撃** の二択入力（片側ロック）
- 敵攻撃：テレグラフ表示 → ガード入力で軽減
- 設定（パック/難易度/主要A11y）
- 結果（WPM/Accuracy/コンボ/与被ダメの主要値）
- ダッシュボード**最小**（直近履歴 + 数字カード）
- Supabase Auth/RLS、`sessions`/`attempts`/`session_summary`
- **横断最小要件（機能エピックに内包）**
  - 計測: `session_start` / `attempt_commit` / `session_end` の**3イベントのみ**
  - パフォ: `/game` を CSR island、**Phaser を遅延読込（`ssr:false`）**、非`/game`はRSC優先
  - QA: combat計算/二択ロックの**ユニットテスト** + **手動スモーク**（/settings→/game→/results）

> グラフUI、IndexedDB再送、詳細A11y、厳密バンドル予算、E2E自動化は**必要になったら着火**。

---

## 3. 作業ストリーム（スリム統合）

**WS-1 エンジン**: Phaser Adapter + HUD連携 + 戦闘ロジック
**WS-2 UI/設定**: Next.js（SSR/RSC）+ shadcn/ui + i18n最小
**WS-3 API/DB**: Supabase DDL/RLS + Route Handlers（OpenAPI準拠）
（計測/パフォ/QAは各WSの**受入基準に内包**）

---

## 4. タイムライン（MVPフォーカス）

### Sprint 0（準備）: 2025-08-25（月）〜 2025-08-26（火）

**ゴール**: 並行開発の足場を最短で用意。

- architecture.md 初稿（`/game` をCSR island、Phaser遅延）
- `supabase/ddl.sql` 適用 & ローカル接続テスト
- `docs/api/openapi.yaml` 下書き（/session, /attempt, /session/end）
- Next.js 初期化 + `/game` ページ（dynamic import）
- npm scripts: build/lint/typecheck/test

**内包AC（横断）**

- Phaserが`/game`のみで読み込まれる
- DDL/RLSが適用される（ローカルでINSERT/SELECT確認）

---

### Sprint 1: 2025-08-27（水）〜 2025-09-02（火）

**ゴール**: **コアループが遊べる**状態。

- GameAdapter IF + PhaserAdapter 初期化（60fps/resize/input）
- **二択ロック**（攻撃/回復）
- combat計算ユーティリティ（ダメージ/回復/ガード）
- HUD（HP/WPM/Accuracy/Combo/Timer）
- 敵攻撃テレグラフ → ガード軽減

**受入基準（含む横断）**

- `/game`で攻撃/回復/ガード一連が通る
- **ユニットテスト**（combat/ロック）が緑
- 手動スモーク動画を添付

---

### Sprint 2: 2025-09-03（水）〜 2025-09-09（火）

**ゴール**: 永続化・設定・結果を結線。

- API: `/api/session`, `/api/attempt`, `/api/session/end`
- DB: 匿名セッション作成、`session_summary` 参照
- 設定（パック/難易度/主要A11y）
- 結果画面（主要指標の**数字カード**）
- **3イベントのみ**計測を保存（同期送信でOK）

**受入基準（含む横断）**

- ゲストでプレイ→結果→履歴に反映（RLSで他ユーザー不可視）
- `session_start/attempt_commit/session_end` がDBで確認できる

---

### Sprint 3（磨き込み/フリーズ前）: 2025-09-10（水）〜 2025-09-12（金）

**ゴール**: 最低限のA11y/Perf/文言整備でフリーズ。

- フォーカス維持・可視リング・キーボード完結のみ担保
- 非`/game`はクライアント境界最小、必要箇所のみCSR
- 文言・i18nキー最小（ja優先、enは要所）
- バグ修正 & エッジケース（Pause/フォーカス喪失）

**受入基準（含む横断）**

- キーボードのみでプレイ可能、重大なA11y問題なし
- 非`/game`の初期JSが過度に膨らんでいない（計測メモを残す）

---

### リリース準備（短期QA）: 2025-09-13（土）〜 2025-09-15（月）

- スモーク（3端末×主要ブラウザ）
- 最小限のセキュリティヘッダー/CSP
- OG/SEO/i18nメタ確認
- KPIの初期集計SQL用意

**MVPリリース**: **2025-09-16（火）**

---

## 5. v1.0（MVP後の最短差分）

- 係数チューニング（実データから）
- ゲスト→ログインのセッション移譲（Cookie紐付け）
- 単語パック管理（CSVインポート最小UI）
- ダッシュ拡充（週次推移、パック別）
- PWA準備（Install + キャッシュ最低限）
- A11y追加（読み上げON/OFF、文字間隔調整）

**v1.0 Exit Criteria**

- D7 ≥ 25%
- 重大/高の不具合=0
- 平均セッション長 ≥ 8分

---

## 6. スコープ調整ルール（MVP）

**削る順**（影響小→大）

1. ダッシュのグラフ → 数字カードのみ
2. i18nの英語文言の一部（日本語優先）
3. 設定の細かなA11yオプション（コアのみ）
4. 結果の詳細統計（トップ指標のみ）

---

## 7. リスク / トリガー（JIT対応方針）

| リスク/兆候        | 対応トリガー    | 取るアクション                                     |
| ------------------ | --------------- | -------------------------------------------------- |
| 入力系のブラウザ差 | 誤入力報告      | IME無効/キー正規化の強化、主要ブラウザ追加スモーク |
| バンドル肥大       | LCP悪化/JS>想定 | `/game`分離維持、analyzerで依存見直し、画像圧縮    |
| 計測不足           | KPIが読めない   | イベント追加（`enemy_attack`等）/IndexedDB再送導入 |
| バグ再発           | 報告増加        | Playwright 1本導入、axe自動化を**必要範囲で**追加  |

---

## 8. Definition of Ready / Done（スリム版）

**DoR**

- Issueに PRD/RFCの該当リンクと**AC**がある
- 依存が洗い出されている

**DoD**

- AC満たす**ユニットテスト**緑
- 型/リンタ0
- 最小ドキュメント更新（CHANGELOG/スクショ or 動画）

---

## 9. リリース手順（最小）

1. Release Branch 切出し
2. タグ付与・CHANGELOG
3. Vercel Production デプロイ
4. 手動スモーク（チェックリスト）
5. KPI初期監視（24/72h、SQLでOK）
